<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Management</title>
    <link rel="stylesheet" href="eventstyle.css">
</head>

<body>
    <section id="event-">
        <div id="event-f-container">
            <button id="open-event-form">Add New Event</button>
        </div>

        <!-- Event Form Modal -->
        <div id="event-form-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Add New Event</h2>
                <form id="event-form">
                    <label>Topic:</label><br>
                    <input type="text" name="topic" required><br>

                    <label>Date and Time:</label><br>
                    <input type="datetime-local" name="datetime" required><br>

                    <label>Location:</label><br>
                    <input type="text" name="location" required><br>

                    <label>Google Map link:</label><br>
                    <input type="text" name="location-googlemap-link" required><br>

                    <label>Organizers:</label><br>
                    <input type="text" name="organizers" required><br>

                    <label>Description:</label><br>
                    <textarea name="description" required></textarea><br>

                    <button type="submit">Submit Event</button>
                </form>
            </div>
        </div>
    </section>

    <section id="event-list">
        <div id="event-L-container">
            <!-- Event Cards will appear here -->
        </div>
    </section>

    <!-- Script -->
    <script>
        // Show event form modal
        document.getElementById("open-event-form").onclick = function () {
            document.getElementById("event-form-modal").style.display = "block";
        };

        // Close the event form modal
        document.querySelector(".close").onclick = function () {
            document.getElementById("event-form-modal").style.display = "none";
        };

        // Optional: Close modal when clicking outside the content
        window.onclick = function (event) {
            if (event.target == document.getElementById("event-form-modal")) {
                document.getElementById("event-form-modal").style.display = "none";
            }
        };

        // Load events and display them
        function loadEvents() {
            fetch('get-events.php')
                .then(response => response.json())
                .then(events => {
                    const container = document.getElementById('event-L-container');
                    container.innerHTML = '';

                    events.forEach(event => {
                        const card = document.createElement('div');
                        card.className = 'event-card';
                        card.innerHTML = `
    <h3>${event.topic}</h3>
    <p class="event-datetime">ðŸ“… <strong>${new Date(event.datetime).toLocaleString()}</strong></p>

    <p><strong>Location:</strong> ${event.location}</p>
    <p><a href="${event.google_map_link}" target="_blank">View on Google Maps</a></p>
    <p><strong>Organizers:</strong> ${event.organizers}</p>
    <p>${event.description}</p>

    <div class="social-share">
        <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(event.topic)}" target="_blank" class="social-button facebook">Facebook</a>

        <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(event.topic)}&url=${encodeURIComponent(window.location.href)}" target="_blank" class="social-button twitter">Twitter</a>

        <a href="https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.href)}" target="_blank" class="social-button linkedin">LinkedIn</a>

        <a href="https://api.whatsapp.com/send?text=${encodeURIComponent(event.topic + ' - ' + new Date(event.datetime).toLocaleString() + ' at ' + event.location + ' â€¢ More info: ' + window.location.href)}" target="_blank" class="social-button whatsapp">WhatsApp</a>
    </div>
`;


                        container.appendChild(card);
                    });
                });
        }

        // Load events on page load
        window.onload = loadEvents;

        // Event form submission handler
        document.getElementById("event-form").addEventListener("submit", function (e) {
            e.preventDefault(); // Prevent page reload

            const form = e.target;
            const formData = new FormData(form);

            // Submit event form data to the server
            fetch('submit-event.php', {
                method: 'POST',
                body: formData
            })
                .then(res => res.text())
                .then(response => {
                    console.log(response); // For debugging
                    loadEvents(); // Refresh event list after submission
                    form.reset(); // Reset form fields
                    document.getElementById("event-form-modal").style.display = "none"; // Hide modal
                })
                .catch(error => {
                    console.error("Error submitting form:", error);
                });
        });
    </script>
</body>

</html>